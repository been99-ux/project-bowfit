<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 부트스트랩 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 부트스트랩 동작 스크립 다운로드! -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- 제이쿼리  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script src="/js/main.js"></script>

    <!-- 내 스타일  -->
    <link href="/css/main/styles.css" rel="stylesheet">
    <link href="/css/myPage/myPage.css" rel="stylesheet">
</head>

<body>
<th:block th:replace="common/header::header"></th:block>
<!-- 여기는 적림금 section 입니다 ! -->
<!-- 적립금 title ! -->
<h2 id="myPage_title">마이페이지</h2>
<div class="myPage_section container py-4" style="max-width: 860px">
    <h4>나의 적립금 현황</h4>
    <div class="myPage_content container py-4" style="max-width: 860px">
        <div class="row">
            <!-- Left Section -->
            <div class="myPage_point col-md-6 border-end">
                <div class="mb-3 d-flex justify-content-between align-items-center">
                    <span>가용적립금</span>
                    <div>
                        <span class="text-primary fw-bold">3,000원</span>
                        <button class="btn btn-outline-secondary btn-sm ms-2"
                                onclick="location.href='/mypage/mileage'">
                            조회
                        </button>
                    </div>
                </div>
                <div class="mb-3 d-flex justify-content-between align-items-center">
                    <span>사용적립금</span>
                    <span class="myPage_use_point fw-bold">0원</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span>쿠폰</span>
                    <div>
                        <span id="couponCount" class="fw-bold">0개</span>  <!-- ✅ 쿠폰 개수 표시 -->
                        <button class="btn btn-outline-secondary btn-sm ms-2"
                                id="goToCouponHistory">
                            조회
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Section -->
            <div class="myPage_total col-md-6">
                <div class="mb-3 d-flex justify-content-between align-items-center">
                    <span>총적립금</span>
                    <span class="fw-bold text-primary">3,000원</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span>총주문</span>
                    <span class="fw-bold">0원 (0회)</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 여기는 주문현황 section 입니다 ! -->
<!-- 여기는 주문현황 title 입니다 ! -->
<div class="myPage_section container py-4" style="max-width: 860px">
    <div class="myPage_title_second">
        <div>
            <h4>나의 주문처리 현황</h4>
        </div>
        <div>
            <h3>(최근 3개월 기준)</h3>
        </div>
    </div>
    <div class="myPage_second_section container py-4" style="max-width: 860px">
        <!-- Order Status Section -->
        <div class="row text-center">
            <div class="col-md-2">
                <div class="fw-bold text-secondary">입금전</div>
                <div class="fs-4 text-primary">0</div>
            </div>
            <div class="col-md-2 border-start">
                <div class="fw-bold text-secondary">배송준비중</div>
                <div class="fs-4 text-primary">0</div>
            </div>
            <div class="col-md-2 border-start">
                <div class="fw-bold text-secondary">배송중</div>
                <div class="fs-4 text-primary">0</div>
            </div>
            <div class="col-md-2 border-start">
                <div class="fw-bold text-secondary">배송완료</div>
                <div class="fs-4 text-primary">0</div>
            </div>
            <div class="col-md-4 text-start">
                <ul class="list-unstyled mt-3">
                    <li class="mb-1">
                        <span class="text-secondary">취소:</span>
                        <span class="fw-bold">0</span>
                    </li>
                    <li class="mb-1">
                        <span class="text-secondary">교환:</span>
                        <span class="fw-bold">0</span>
                    </li>
                    <li class="mb-1">
                        <span class="text-secondary">반품:</span>
                        <span class="fw-bold">0</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- 적립금 및 나의 주문처리 현황 테이블 끝 -->

<!-- 여기는 회원정보, QnA 게시물 관리, 관심 상품, 주문내역 조회 section 입니다 ! -->
<div class="container container-box py-4">
    <div class="row-box">
        <a th:href="@{/mypage/profile}" class="box-wrapper text-decoration-none text-dark">
            <div class="box">
                <h5>회원 정보</h5>
                <p>Profile</p>
                <i class="bi bi-person-square fs-1" style="padding-bottom: 20px"></i>
                <p>회원님의 개인정보를</p>
                <p>보관하는 곳입니다.</p>
            </div>
        </a>
        <a th:href="@{/community/postManagement}" class="box-wrapper text-decoration-none text-dark">
            <div class="box">
                <h5>게시물 관리</h5>
                <p>Board</p>
                <i class="bi bi-pencil-square fs-1" style="padding-bottom: 20px"></i>
                <p>고객님께서 작성하신 Q&A 게시물을</p>
                <p>관리하는 곳입니다.</p>
            </div>
        </a>
        <a th:href="@{/wishlist}" class="box-wrapper text-decoration-none text-dark">
            <div class="box">
                <h5>관심 상품</h5>
                <p>Wishlist</p>
                <i class="bi bi-gift fs-1" style="padding-bottom: 20px"></i>
                <p>관심상품으로 등록하신</p>
                <p>상품의 목록을 보여드립니다.</p>
            </div>
        </a>
        <a th:href="@{/prepare}" class="box-wrapper text-decoration-none text-dark">
            <div class="box">
                <h5>주문내역 조회(준비중)</h5>
                <p>Orders</p>
                <i class="bi bi-search fs-1" style="padding-bottom: 20px"></i>
                <p>고객님께서 주문하신 상품의</p>
                <p>주문내역을 확인하실 수 있습니다.</p>
            </div>
        </a>
    </div>
</div>

<th:block th:replace="common/footer::footer"></th:block>
</body>
<script>
    window.onload = function() {
        fetch('/myPage/couponCount') // ✅ 서버에서 쿠폰 개수 가져오기
            .then(response => response.json())
            .then(data => {
                document.getElementById("couponCount").textContent = data + "개";
            })
            .catch(error => console.error('Error fetching coupon count:', error));
    };

    document.getElementById("goToCouponHistory").addEventListener("click", function() {
        fetch('/getMemberId') // memberId를 가져오는 API 호출 (서버에서 JSON 응답)
            .then(response => response.json())
            .then(data => {
                if (data.memberId) {
                    location.href = `/myPage/couponHistory?memberId=${data.memberId}`;
                } else {
                    alert("로그인이 필요합니다.");
                    location.href = "/login";
                }
            })
            .catch(error => console.error('Error fetching memberId:', error));
    });
</script>
</html>